import { useState } from 'react';

const useOnboarding = () => {
  const [currentStep, setCurrentStep] = useState(0); // Start at 0 for WelcomeStep
  const [formData, setFormData] = useState({
    // Household and Period data
    household: {
      name: '',
      created_date: null
    },
    period: {
      duration_months: 6,
      start_date: null,
      period_number: 1,
      end_date: null // will be calculated
    },
    // Financial data
    income: [],
    savingsAllocation: { // Combined savings rate + allocation
      savingsRate: 40, 
      monthlySavings: 0,
      emergencyFund: { hasExisting: false, monthlyAmount: '' },
      savingsGoals: []
    },
    expenses: [],
    netWorth: { assets: [], liabilities: [] }
  });

  const totalSteps = 5; // 0: Welcome, 1: Income, 2: Savings Allocation, 3: Expenses, 4: Net Worth

  const nextStep = () => {
    if (currentStep < totalSteps - 1) {
      setCurrentStep(currentStep + 1);
    }
  };

  const prevStep = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  const updateFormData = (section, data) => {
    setFormData(prev => ({
      ...prev,
      [section]: data
    }));
  };

  // Special handler for welcome step data
  const setHouseholdAndPeriod = (welcomeData) => {
    const endDate = new Date(welcomeData.period.start_date);
    endDate.setMonth(endDate.getMonth() + welcomeData.period.duration_months);
    
    setFormData(prev => ({
      ...prev,
      household: welcomeData.household,
      period: {
        ...welcomeData.period,
        end_date: endDate.toISOString().split('T')[0]
      }
    }));
  };

  return {
    currentStep,
    totalSteps,
    formData,
    nextStep,
    prevStep,
    updateFormData,
    setCurrentStep,
    setHouseholdAndPeriod
  };
};
